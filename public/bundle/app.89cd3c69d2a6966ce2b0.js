!function(e){function t(t){for(var n,l,i=t[0],s=t[1],u=t[2],d=0,f=[];d<i.length;d++)l=i[d],Object.prototype.hasOwnProperty.call(r,l)&&r[l]&&f.push(r[l][0]),r[l]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);f.length;)f.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,i=1;i<a.length;i++){var s=a[i];0!==r[s]&&(n=!1)}n&&(o.splice(t--,1),e=l(l.s=a[0]))}return e}var n={},r={0:0},o=[];function l(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=n,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(a,n,function(t){return e[t]}.bind(null,n));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var c=s;o.push([13,1]),a()}([,,,,,,function(e,t,a){var n;void 0===(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return console.log("Websocket connection established!")},n=function(e){"string"==typeof e.data?document.dispatchEvent(new CustomEvent("WebSocketStringMessage",{detail:e.data})):console.log(e.data)},r=function(){console.log("Websocket connection broke! Restoring..."),setTimeout(window.startWebSocket,1e3)},o=function(e){console.error("Websocket errored: ",e),window.ws.close()};t.init=function(){window.startWebSocket=function(){var e="https:"===document.location.protocol?"wss":"ws";window.ws=new WebSocket(e+"://"+document.location.hostname+":8888"),window.ws.onopen=a,window.ws.onclose=r,window.ws.onmessage=n,window.ws.onerror=o}},t.sendWebSocketData=function(e){return window.ws.send(e)}}.apply(t,[a,t]))||(e.exports=n)},,,,,,,function(e,t,a){var n,r,o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};n=[a,t,a(0),a(3),a(18),a(41),a(43),a(45)],void 0===(r=function(e,t,a,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=o(a),(n=o(n)).default.render(a.default.createElement(r.App,null),document.getElementById("root"))}.apply(t,n))||(e.exports=r)},,,,,function(e,t,a){var n,r,o,l=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};n=[a,t,a(0),a(47),a(6),a(21),a(24),a(27),a(39)],void 0===(r=function(e,t,a,n,r,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=i(a);var c=function(e){n.toast.error(e,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0})},d=function(e,t){n.toast.success(e,{position:"top-right",autoClose:null!=t?t:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0})},f=function(e){function t(t){var a=e.call(this,t)||this;return a.state={isAuthorized:!1,isAuthenticated:"jwt"in localStorage,isAuthChecked:!1},a.handleSignOut=a.handleSignOut.bind(a),a}return l(t,e),t.prototype.componentDidMount=function(){var e=this;if(r.init(),setTimeout(window.startWebSocket,100),document.addEventListener("WebSocketStringMessage",(function(t){var a=JSON.parse(t.detail);"authorization"===a.type?"error"===a.data.result?c(a.data.reason):(localStorage.setItem("jwt",a.data.payload.jwt),localStorage.setItem("uuid",a.data.payload.uuid),d("Authorization successful",2e3),setTimeout((function(){e.setState({isAuthorized:!0,isAuthenticated:"jwt"in localStorage})}),2e3)):"authentication"===a.type?"error"===a.data.result?(c(a.data.reason),e.setState({isAuthChecked:!0})):e.setState({isAuthChecked:!0,isAuthorized:!0}):"upload-image"===a.type?"error"===a.data.result?c(a.data.reason):d("Image '"+a.data.image.name+"' uploaded"):"delete-image"===a.type&&("error"===a.data.result?c(a.data.reason):d("Image "+a.data.name+" has been deleted"))})),"jwt"in localStorage)var t=setInterval((function(){1===window.ws.readyState&&(r.sendWebSocketData(JSON.stringify({type:"authentication",data:{jwt:localStorage.getItem("jwt"),uuid:localStorage.getItem("uuid")}})),clearInterval(t))}),100);else this.setState({isAuthChecked:!0})},t.prototype.handleSignOut=function(){localStorage.removeItem("jwt"),localStorage.removeItem("uuid"),this.setState({isAuthenticated:!1,isAuthorized:!1})},t.prototype.render=function(){return a.default.createElement(a.Fragment,null,this.state.isAuthChecked?this.state.isAuthorized&&this.state.isAuthenticated?a.default.createElement(u.Dashboard,{handleSignOut:this.handleSignOut}):a.default.createElement(o.Authorization,{handleAuth:function(e,t){return a=e,n=t,void r.sendWebSocketData(JSON.stringify({type:"authorization",data:{login:a,password:n}}));var a,n}}):a.default.createElement(s.Loader,null),a.default.createElement(n.ToastContainer,null))},t}(a.Component);t.App=f}.apply(t,n))||(e.exports=r)},,,function(e,t,a){var n,r,o=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var n,r,o=a.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)l.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return l},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};n=[a,t,a(0),a(22)],void 0===(r=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=l(a),t.Authorization=function(e){var t=o(a.useState(""),2),n=t[0],r=t[1],l=o(a.useState(""),2),i=l[0],s=l[1];return a.useEffect((function(){return document.body.classList.add("signin"),function(){return document.body.classList.remove("signin")}}),[]),a.default.createElement("form",{className:"form-signin text-center",onSubmit:function(e){return e.preventDefault()}},a.default.createElement("h1",{className:"h3 mb-3 font-weight-normal"},"Sign in please"),a.default.createElement("label",{htmlFor:"inputLogin",className:"sr-only"},"Login"),a.default.createElement("input",{onInput:function(e){return r(e.target.value)},value:n,type:"text",id:"inputLogin",className:"form-control",placeholder:"Login",required:!0,autoFocus:!0,onChange:function(){}}),a.default.createElement("label",{htmlFor:"inputPassword",className:"sr-only"},"Password"),a.default.createElement("input",{onInput:function(e){return s(e.target.value)},value:i,type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:!0,onChange:function(){}}),a.default.createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",onClick:function(){return e.handleAuth(n,i)}},"Sign in"))}}.apply(t,n))||(e.exports=r)},function(e,t,a){var n=a(2),r=a(23);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1};n(r,o);e.exports=r.locals||{}},function(e,t,a){},function(e,t,a){var n,r,o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};n=[a,t,a(0),a(25)],void 0===(r=function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=o(a),t.Loader=function(){return a.useEffect((function(){return document.body.classList.add("loading"),function(){return document.body.classList.remove("loading")}}),[]),a.default.createElement("div",{className:"loader-box"},a.default.createElement("div",{className:"spinner-border text-primary",role:"status"},a.default.createElement("span",{className:"sr-only"},"Loading...")))}}.apply(t,n))||(e.exports=r)},function(e,t,a){var n=a(2),r=a(26);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1};n(r,o);e.exports=r.locals||{}},function(e,t,a){},function(e,t,a){var n,r,o=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var n,r,o=a.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)l.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return l},l=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],n=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};n=[a,t,a(0),a(10),a(11),a(6),a(31)],void 0===(r=function(e,t,a,n,r,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=s(a);t.Dashboard=function(e){var t=o(a.useState([]),2),s=t[0],d=t[1],f=new Audio("/static/notify.mp3");f.volume=.2;var m=a.useCallback((function(e){var t=JSON.parse(e.detail);"latest-entries"===t.type?d(t.data):"new-entry"===t.type?(f.play(),d((function(e){var a=l(e);return 20===a.length&&a.pop(),a.unshift(t.data.entry),a}))):"entry-status-update"===t.type&&d((function(e){var a,n,r=l(e);try{for(var o=i(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===t.data.id){u.status=t.data.status,u.status_descr&&(u.status_descr=t.data.status_descr);break}}}catch(e){a={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return r}))}),[]);return a.useEffect((function(){return document.body.classList.add("dashboard"),document.addEventListener("WebSocketStringMessage",m),u.sendWebSocketData(JSON.stringify({type:"latest-entries",data:{count:20}})),function(){document.body.classList.remove("dashboard"),document.removeEventListener("WebSocketStringMessage",m)}}),[m]),a.default.createElement(a.Fragment,null,a.default.createElement("nav",{className:"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow"},a.default.createElement("a",{className:"navbar-brand col-sm-3 col-md-2 mr-0",href:"#"},"Anomaly"),a.default.createElement("ul",{className:"navbar-nav px-3"},a.default.createElement("li",{className:"nav-item text-nowrap"},a.default.createElement("a",{className:"nav-link",href:"#",onClick:function(t){return function(t){t.preventDefault(),e.handleSignOut()}(t)}},"Sign out")))),a.default.createElement("div",{className:"container-fluid"},a.default.createElement("div",{className:"row"},a.default.createElement("nav",{className:"col-md-2 d-none d-md-block bg-light sidebar"},a.default.createElement("div",{className:"sidebar-sticky"},a.default.createElement("ul",{className:"nav flex-column"},a.default.createElement("li",{className:"nav-item"},a.default.createElement(n.FontAwesomeIcon,{icon:r.faHistory}),a.default.createElement("a",{className:"nav-link active",href:"#"},"History"))))),a.default.createElement("main",{role:"main",className:"col-md-9 ml-sm-auto col-lg-10 px-4"},a.default.createElement("div",{className:"pt-3 pb-2 mb-3"},a.default.createElement("h1",{className:"h2"},"History"),a.default.createElement("div",{className:"container-fluid history-holder pt-4"},s.map((function(e,t){return a.default.createElement(c.Entry,{key:e.id,i:t,latestLength:s.length,entry:e})}))))))))}}.apply(t,n))||(e.exports=r)},,,,function(e,t,a){var n,r,o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=this&&this.__read||function(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var n,r,o=a.call(e),l=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)l.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return l},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},u=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t};n=[a,t,a(4),a(32),a(0),a(10),a(11),a(48),a(6),a(33),a(35),a(37)],void 0===(r=function(e,t,a,n,r,c,d,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=s(n),r=u(r);var p={arrow:"round",popperOptions:{modifiers:[{name:"computeStyles",options:{gpuAcceleration:!1}}]},animateFill:!0,plugins:[a.animateFill]},h=["янв","фев","мар","апр","мая","июн","июл","авг","сен","окт","ноя","дек"],v=function(e){var t=new Date(e);return t.getDate()+" "+h[t.getMonth()]+" "+t.getFullYear()};function g(e){return"declined"===e.statusText||"failed"===e.statusText?r.default.createElement(n.default,o({disabled:!e.descr,content:e.descr},p),r.default.createElement("div",{className:"text-danger text-center"},r.default.createElement("strong",null,"declined"===e.statusText?"Отклонено":"Ошибка"),r.default.createElement("small",{className:"d-block text-truncate"},e.descr))):"processing"===e.statusText?r.default.createElement(n.default,o({disabled:!e.descr,content:e.descr},p),r.default.createElement("div",{className:"text-primary text-center"},r.default.createElement("div",{className:"spinner-border spinner-border-sm text-primary",role:"status"},r.default.createElement("span",{className:"sr-only"},"Loading...")),r.default.createElement("small",{className:"d-block text-truncate"},e.descr))):r.default.createElement("div",{className:"text-success text-center"},r.default.createElement(c.FontAwesomeIcon,{icon:d.faCheckCircle}))}t.Entry=function(e){var t=l(r.useState("entering"),2),a=t[0],s=t[1],u=l(r.useState(e.entry.images),2),h=u[0],y=u[1],b=JSON.parse(e.entry.full_info),E=r.useCallback((function(e){e.forEach((function(e){var t=new FileReader;t.onloadend=function(){var a=t.result;m.sendWebSocketData(JSON.stringify({type:"upload-image",data:{base64:a,mimeType:e.type,destinationCode:b.segments[0].destination.cityCode}}))},t.readAsDataURL(e)}))}),[]),_=r.useCallback((function(t){var a,n=JSON.parse(t.detail);if("upload-image"===n.type&&(null===(a=n.data.image)||void 0===a?void 0:a.destination)===b.segments[0].destination.cityCode)y((function(e){var t=i(e);return t.push(n.data.image),t}));else if("delete-image"===n.type){if("success"===n.data.result)if(n.data.name.split("").splice(0,3).join("")===e.entry.destination){for(var r=i(h),o=0;o<r.length;o++)n.data.name===r[o].name&&r.splice(o,1);y(r)}}}),[]),w=f.useDropzone({accept:"image/jpeg, image/png, image/webp",onDrop:E}),S=w.getRootProps,x=w.getInputProps,N=w.isDragActive;return r.useEffect((function(){return document.addEventListener("WebSocketStringMessage",_),setTimeout((function(){return s("entered")}),50*e.i),function(){return document.removeEventListener("WebSocketStringMessage",_)}}),[_]),r.default.createElement("div",{className:["card",e.i+1<e.latestLength?"mb-3":"",a,,N?"dragged":""].join(" ")},r.default.createElement("div",o({},S({className:"dropzone"})),r.default.createElement("input",o({},x())),r.default.createElement("div",{className:"card-body d-flex align-items-center",style:{cursor:"default"}},N?r.default.createElement("div",{className:"d-flex align-items-center justify-content-center drag-n-drop col-12"},r.default.createElement("p",{className:"h5 text-muted"},"Drop your files here...")):r.default.createElement(r.Fragment,null,r.default.createElement(n.default,o({content:b.airline},p),r.default.createElement("div",{className:"image-holder col-md-1 col-xs-12 text-center"},r.default.createElement("img",{src:"https://pics.avs.io/al_square/160/160/"+b.airline+"@2x.png",style:{width:"100%"}}))),r.default.createElement("div",{className:"route d-flex col-md-5 col-xs-12"},r.default.createElement(n.default,o({content:b.segments[0].origin.name},p),r.default.createElement("div",{className:"origin d-block text-truncate col-md-6 col-xs-12 text-center"},b.segments[0].origin.name,r.default.createElement("small",{className:"text-muted d-block"},"Город отправки"))),r.default.createElement(n.default,o({content:b.segments[0].destination.name},p),r.default.createElement("div",{className:"destination d-block text-truncate col-md-6 col-xs-12 text-center"},b.segments[0].destination.name,r.default.createElement("small",{className:"text-muted d-block"},"Город прибытия")))),r.default.createElement("div",{className:"dates col-md-2 col-xs-12 text-center"},r.default.createElement("div",{className:"there"},r.default.createElement("small",{className:"text-muted"},"Туда: "),r.default.createElement("small",null,v(e.entry.there_date))),e.entry.back_date&&r.default.createElement("div",{className:"thence"},r.default.createElement("small",{className:"text-muted"},"Назад: "),r.default.createElement("small",null,v(e.entry.back_date)))),r.default.createElement("div",{className:"status col-md-4 col-xs-12"},r.default.createElement(g,{statusText:e.entry.status,descr:e.entry.status_descr}))))),h.length>0&&r.default.createElement("div",{className:"card-body d-flex align-items-center images-holder border-top pl-0 pr-0 mr-4 ml-4"},h.map((function(e){return r.default.createElement("div",{className:"image col-md-2 col-xs-12 mr-4",style:{backgroundImage:"url(/images/thumbnails/"+e.name+")"},key:e.id},r.default.createElement(c.FontAwesomeIcon,{onClick:function(){return t=e.name,void m.sendWebSocketData(JSON.stringify({type:"delete-image",data:{name:t}}));var t},icon:d.faTimes}))}))))}}.apply(t,n))||(e.exports=r)},,,,,,,,,,,,,,function(e,t,a){var n=a(2),r=a(46);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var o={insert:"head",singleton:!1};n(r,o);e.exports=r.locals||{}},function(e,t,a){}]);